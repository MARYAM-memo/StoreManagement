@using StoreManagement.Models.Inventory

@model StockTransaction

@{
    ViewData["Title"] = "Transaction Details";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-info-circle"></i> Transaction Details
        </h1>
        <div>
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </div>

    <!-- Transaction Details Card -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">Transaction #@Model.Id</h6>
                    <span class="badge @GetTransactionBadgeClass(Model.TransactionType)">
                        @Model.TransactionType
                    </span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-6">
                            <h5 class="text-primary mb-3">Transaction Information</h5>
                            <table class="table table-sm table-borderless">
                                <tr>
                                    <th>Date & Time:</th>
                                    <td>@Model.TransactionDate.ToString("MMM dd, yyyy HH:mm")</td>
                                </tr>
                                <tr>
                                    <th>Transaction Type:</th>
                                    <td>
                                        <span class="badge @GetTransactionBadgeClass(Model.TransactionType)">
                                            @Model.TransactionType
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Reference Number:</th>
                                    <td>
                                        @if (!string.IsNullOrEmpty(Model.ReferenceNumber))
                                        {
                                            <code>@Model.ReferenceNumber</code>
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                </tr>
                                @if (!string.IsNullOrEmpty(Model.ReferenceType))
                                {
                                    <tr>
                                        <th>Reference Type:</th>
                                        <td>@Model.ReferenceType</td>
                                    </tr>
                                }
                                @if (Model.ReferenceId.HasValue)
                                {
                                    <tr>
                                        <th>Reference ID:</th>
                                        <td>@Model.ReferenceId</td>
                                    </tr>
                                }
                            </table>
                        </div>

                        <!-- Right Column -->
                        <div class="col-md-6">
                            <h5 class="text-primary mb-3">Product Details</h5>
                            <table class="table table-sm table-borderless">
                                <tr>
                                    <th>Product:</th>
                                    <td>
                                        <strong>@Model.Product?.Name</strong>
                                        
                                    </td>
                                </tr>
                                <tr>
                                    <th>Quantity:</th>
                                    <td>
                                        @if (Model.TransactionType == "Sale")
                                        {
                                            <span class="text-danger">-@Model.Quantity</span>
                                        }
                                        else
                                        {
                                            <span class="text-success">+@Model.Quantity</span>
                                        }
                                        units
                                    </td>
                                </tr>
                                <tr>
                                    <th>Unit Cost:</th>
                                    <td>@Model.UnitCost.ToString("C")</td>
                                </tr>
                                <tr class="table-active">
                                    <th>Total Cost:</th>
                                    <td
                                        class="fw-bold @(Model.TransactionType == "Sale" ? "text-danger" : "text-success")">
                                        @Model.TotalCost.ToString("C")
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- Supplier/Customer Info -->
                    @if (Model.Supplier != null || Model.TransactionType == "Sale")
                    {
                        <div class="mt-4 pt-3 border-top">
                            <h5 class="text-primary mb-3">
                                @(Model.TransactionType == "Purchase" ? "Supplier" : "Customer") Information
                            </h5>
                            @if (Model.Supplier != null)
                            {
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-sm table-borderless">
                                            <tr>
                                                <th>Supplier:</th>
                                                <td>@Model.Supplier.Name</td>
                                            </tr>
                                            @if (!string.IsNullOrEmpty(Model.Supplier.ContactPerson))
                                            {
                                                <tr>
                                                    <th>Contact Person:</th>
                                                    <td>@Model.Supplier.ContactPerson</td>
                                                </tr>
                                            }
                                            @if (!string.IsNullOrEmpty(Model.Supplier.Phone))
                                            {
                                                <tr>
                                                    <th>Phone:</th>
                                                    <td>@Model.Supplier.Phone</td>
                                                </tr>
                                            }
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-sm table-borderless">
                                            @if (!string.IsNullOrEmpty(Model.Supplier.Email))
                                            {
                                                <tr>
                                                    <th>Email:</th>
                                                    <td>@Model.Supplier.Email</td>
                                                </tr>
                                            }
                                            @if (!string.IsNullOrEmpty(Model.Supplier.Address))
                                            {
                                                <tr>
                                                    <th>Address:</th>
                                                    <td>@Model.Supplier.Address</td>
                                                </tr>
                                            }
                                        </table>
                                    </div>
                                </div>
                            }
                            else if (Model.TransactionType == "Sale")
                            {
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i>
                                    This is a customer sale. Customer information can be found in the Sales module.
                                </div>
                            }
                        </div>
                    }

                    <!-- Notes -->
                    @if (!string.IsNullOrEmpty(Model.Notes))
                    {
                        <div class="mt-4 pt-3 border-top">
                            <h5 class="text-primary mb-3">Notes</h5>
                            <p class="text-muted">@Model.Notes</p>
                        </div>
                    }

                    <!-- System Info -->
                    <div class="mt-4 pt-3 border-top">
                        <h5 class="text-primary mb-3">System Information</h5>
                        <table class="table table-sm table-borderless">
                            <tr>
                                <th>Transaction ID:</th>
                                <td>@Model.Id</td>
                            </tr>
                            @if (Model.CreatedBy.HasValue)
                            {
                                <tr>
                                    <th>Created By:</th>
                                    <td>User #@Model.CreatedBy</td>
                                </tr>
                            }
                            <tr>
                                <th>Created At:</th>
                                <td>@Model.TransactionDate.ToString("MMM dd, yyyy HH:mm:ss")</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-cog"></i> Actions
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        @if (Model.Product != null)
                        {
                            <a asp-controller="Products" asp-action="Details" asp-route-id="@Model.ProductId"
                                class="btn btn-info">
                                <i class="fas fa-box"></i> View Product
                            </a>
                        }

                        @if (Model.Supplier != null)
                        {
                            <a asp-controller="Suppliers" asp-action="Details" asp-route-id="@Model.SupplierId"
                                class="btn btn-warning">
                                <i class="fas fa-truck"></i> View Supplier
                            </a>
                        }

                        <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Delete Transaction
                        </a>

                        <button type="button" class="btn btn-secondary" onclick="window.print()">
                            <i class="fas fa-print"></i> Print Details
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stock Impact -->
            <div class="card shadow">
                <div class="card-header py-3 bg-info text-white">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-chart-line"></i> Stock Impact
                    </h6>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        @if (Model.TransactionType == "Sale")
                        {
                            <div class="display-6 text-danger mb-2">-@Model.Quantity</div>
                            <div class="text-muted">Units removed from stock</div>
                        }
                        else
                        {
                            <div class="display-6 text-success mb-2">+@Model.Quantity</div>
                            <div class="text-muted">Units added to stock</div>
                        }

                        <hr class="my-3">

                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-dollar-sign"></i> Unit Cost: @Model.UnitCost.ToString("C")
                            </small>
                            <br />
                            <small class="text-muted">
                                <i class="fas fa-calculator"></i> Total Cost: @Model.TotalCost.ToString("C")
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetTransactionBadgeClass(string transactionType)
    {
        return transactionType?.ToLower() switch
        {
            "purchase" => "bg-success",
            "sale" => "bg-primary",
            "return" => "bg-warning",
            "adjustment" => "bg-info",
            "transfer" => "bg-secondary",
            _ => "bg-secondary"
        };
    }
}